(()=>{"use strict";var e={662:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.SpecsExplorerOutput=void 0;const i=n(r(496));t.SpecsExplorerOutput=i.window.createOutputChannel("Specs Explorer")},948:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getSpecsConfig=t.SpecsSuiteConfig=t.SpecsConfigFile=void 0;const i=n(r(496));class u{suites=[];defaults=new a;suitesById=new Map;anySuitesSupportDebug(){for(const[e,t]of this.suitesById)if(t.debugger&&t.debugExecutable)return!0;return!1}}t.SpecsConfigFile=u;class a{isGroup=!1;name;parent=void 0;children=[];buildCommand=void 0;discoveryCommand="";groupSeparator=void 0;discoveryRegex=void 0;runCommand="";debugExecutable=void 0;debugger=void 0;variables={};constructor(e="",t=void 0){this.name=e,this.parent=t}idenfifier(){return this.parent?`${this.parent.idenfifier()}/${this.name}`:this.name}}function d(e,t,r=void 0){if(void 0===e.name)throw new Error("Suite name is required");const s=new a(e.name,r);if(e.group&&(s.isGroup=e.group),e.build&&(s.buildCommand=e.build),e.discover&&(s.discoveryCommand=e.discover),e.groupSeparator&&(s.groupSeparator=e.groupSeparator),e.pattern&&(s.discoveryRegex=e.pattern),e.run&&(s.runCommand=e.run),e.debug&&(s.debugExecutable=e.debug),e.debugger&&(s.debugger=e.debugger),e.suites)for(const r of e.suites)s.children.push(d(r,t));for(const t in e)s.variables[t]=e[t];return t.suitesById.set(s.idenfifier(),s),s}t.SpecsSuiteConfig=a;t.getSpecsConfig=async function(){return await async function(){const e=await i.workspace.findFiles(".specs.json");if(e.length>0){const t=await i.workspace.fs.readFile(e[0]);return function(e){const t=new u;if(e.suites)for(const r of e.suites)t.suites.push(d(r,t));else(e.run||e.discover)&&(e.name||(e.name=""),t.suites.push(d(e,t)));return e.defaults&&(e.defaults.name||(e.defaults.name="defaults"),t.defaults=d(e.defaults,t),t.defaults.isGroup=!0),t.suitesById.forEach((e=>{if(!e.isGroup){e.buildCommand||(e.buildCommand=t.defaults.buildCommand),e.discoveryCommand||(e.discoveryCommand=t.defaults.discoveryCommand),e.groupSeparator||(e.groupSeparator=t.defaults.groupSeparator),e.discoveryRegex||(e.discoveryRegex=t.defaults.discoveryRegex),e.runCommand||(e.runCommand=t.defaults.runCommand),e.debugExecutable||(e.debugExecutable=t.defaults.debugExecutable);for(const r in t.defaults.variables)e.variables[r]||(e.variables[r]=t.defaults.variables[r])}})),t.suitesById.forEach((e=>{!function(e){const t=e.variables;Object.keys(t).forEach((r=>{const s=t[r],o="$"+r;e.buildCommand&&(e.buildCommand=e.buildCommand.replace(o,s)),e.discoveryCommand&&(e.discoveryCommand=e.discoveryCommand.replace(o,s)),e.groupSeparator&&(e.groupSeparator=e.groupSeparator.replace(o,s)),e.discoveryRegex&&(e.discoveryRegex=e.discoveryRegex.replace(o,s)),e.runCommand&&(e.runCommand=e.runCommand.replace(o,s)),e.debugExecutable&&(e.debugExecutable=e.debugExecutable.replace(o,s)),e.debugger&&(e.debugger=e.debugger.replace(o,s))}))}(e)})),t}(JSON.parse(t.toString()))}i.window.showErrorMessage("No specs config file found")}()}},23:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RegisterSpecsTestExtension=void 0;const i=n(r(496)),u=r(95),a=r(439),d=r(948),c=new class{_controller;constructor(){this._controller=i.tests.createTestController("specs-explorer","Specs Explorer"),this._controller.refreshHandler=this.refresh.bind(this),this._controller.resolveHandler=async e=>{e?i.window.showErrorMessage("Resolving individual tests is not supported"):await this.refresh()},this._controller.createRunProfile("Run",i.TestRunProfileKind.Run,this.run.bind(this),!0),(0,d.getSpecsConfig)().then((e=>{e?.anySuitesSupportDebug()&&this._controller.createRunProfile("Debug",i.TestRunProfileKind.Debug,this.debug.bind(this),!0)}))}registerController(e){e.subscriptions.push(this._controller)}registerTestComponent(e,t,r){if(t.type===a.TestComponentType.Test){const s=t,o=`${s.suiteId}|~|~|~|~|${s.filePath}|-|-|-|${s.lineNumber}`;e.add(o);const n=i.Uri.joinPath(i.workspace.workspaceFolders[0].uri,s.filePath),u=this._controller.createTestItem(o,s.description,i.Uri.file(n.fsPath));u.range=new i.Range(new i.Position(s.lineNumber-1,0),new i.Position(s.lineNumber-1,0)),r?r.children.add(u):this._controller.items.add(u)}else if(t.type===a.TestComponentType.TestGroup){const s=t;if(""===s.description)s.children.forEach((t=>{this.registerTestComponent(e,t,r)}));else{const t=`group: ${s.fullDescription()}|${s.suiteId}}`;e.add(t);const o=this._controller.createTestItem(t,s.description);r?r.children.add(o):this._controller.items.add(o),s.children.forEach((t=>{this.registerTestComponent(e,t,o)}))}}}async refresh(){const e=new Set;this._controller.items.forEach((t=>{e.add(t.id)}));const t=await(0,u.discoverTests)();if(!t)return i.window.showErrorMessage("Failed to discover tests"),void this._controller.items.forEach((e=>{this._controller.items.delete(e.id)}));const r=new Set;t.forEach((e=>{this.registerTestComponent(r,e)})),e.forEach((e=>{r.has(e)||this._controller.items.delete(e)}))}addTestsToRun(e,t){t.push(e),e.children.forEach((e=>{this.addTestsToRun(e,t)}))}async run(e,t){await(0,u.buildTestsProject)();const r=this._controller.createTestRun(e),s=[];for(e.include?e.include.forEach((e=>{this.addTestsToRun(e,s)})):this._controller.items.forEach((e=>{this.addTestsToRun(e,s)})),r.appendOutput(`Running ${s.length} tests\n`);s.length>0&&!t.isCancellationRequested;){const t=s.pop();if(e.exclude?.includes(t))continue;if(t.id.startsWith("group:"))continue;const[o,n]=t.id.split("|~|~|~|~|"),[a,d]=n.split("|-|-|-|"),c=Date.now();r.started(t);const p=await(0,u.runTest)(o,a,parseInt(d));if(!p)continue;const l=Date.now()-c;p.testPassed?r.passed(t,l):r.failed(t,new i.TestMessage(p.testOutput),l)}r.end()}async debug(e,t){if(void 0===e.include)return void i.window.showErrorMessage("Debug all tests is not supported");if(e.include.length>1)return void i.window.showErrorMessage("Debugging multiple tests is not supported");const r=e.include[0],[s,o]=r.id.split("|~|~|~|~|"),[n,a]=o.split("|-|-|-|");await(0,u.buildTestsProject)(),await(0,u.debugTest)(s,n,parseInt(a))}};t.RegisterSpecsTestExtension=function(e){c.registerController(e)}},95:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.discoverTests=t.debugTest=t.runTest=t.buildTestsProject=void 0;const i=n(r(496)),u=n(r(81)),a=r(948),d=r(439),c=r(662),p=new class{async buildSuite(e){if(!e.isGroup&&e.buildCommand){const t=e.buildCommand,r={cwd:i.workspace.workspaceFolders?.[0].uri.fsPath};return new Promise((e=>{c.SpecsExplorerOutput.appendLine(`Running ${t}`);const s=u.exec(t,r);s.stdout?.on("data",(e=>{c.SpecsExplorerOutput.appendLine(e)})),s.stderr?.on("data",(e=>{c.SpecsExplorerOutput.appendLine(e)})),s.on("close",(r=>{c.SpecsExplorerOutput.appendLine(`Command ${t} exited with code ${r}`),e()}))}))}}async build(e=void 0){const t=await(0,a.getSpecsConfig)();if(!t?.suites.length)return void i.window.showErrorMessage("No suites specified in specs.json");if(e||(e=Array.from(t.suitesById.keys())),!e.length)return;const r=[];return e.forEach((e=>{const s=t?.suitesById.get(e);s?.isGroup||s?.buildCommand&&r.push(this.buildSuite(s))})),Promise.all(r).then((()=>{}))}async run(e,t,r){const s=await(0,a.getSpecsConfig)(),o=s?.suitesById.get(e);if(o?.isGroup)return;if(!o)return void i.window.showErrorMessage(`Suite '${e}' not found in specs.json`);if(!o?.runCommand)return void i.window.showErrorMessage("No run command specified in specs.json");let n=new d.TestResult;const p=o.runCommand.replace("{file}",t).replace("{line}",r.toString());return new Promise((e=>{const t={cwd:i.workspace.workspaceFolders?.[0].uri.fsPath};c.SpecsExplorerOutput.appendLine(`Running ${p}`);const r=u.exec(p,t,(e=>{e&&(n.testPassed=!1)}));r.stdout?.on("data",(e=>{c.SpecsExplorerOutput.appendLine(e),n.testOutput+=e})),r.stderr?.on("data",(e=>{c.SpecsExplorerOutput.appendLine(e),n.testOutput+=e})),r.on("close",(t=>{c.SpecsExplorerOutput.appendLine(`Command ${p} exited with code ${t}`),n.testPassed=0===t,e(n)}))}))}async debug(e,t,r){const s=await(0,a.getSpecsConfig)(),o=s?.suitesById.get(e);o?.debugExecutable?o?.debugger?i.debug.startDebugging(i.workspace.workspaceFolders?.[0],{name:"Debug Test",type:o.debugger,request:"launch",program:o.debugExecutable,args:[t,r.toString()],cwd:"${workspaceFolder}",environment:[]}):i.window.showErrorMessage("No debugger specified (e.g. cppvsdbg) in specs.json"):i.window.showErrorMessage("No debug command specified in specs.json")}async discoverSuite(e){const t=await(0,a.getSpecsConfig)(),r=t?.suitesById.get(e);if(!r)return void i.window.showErrorMessage(`Suite '${e}' not found in specs.json`);if(r?.isGroup)return;if(!r?.discoveryCommand)return void i.window.showErrorMessage("No discovery command (discover:) specified in specs.json");if(!r?.discoveryRegex)return void i.window.showErrorMessage("No discovery regex (pattern:) specified in specs.json");const s=r.discoveryCommand,o={cwd:i.workspace.workspaceFolders?.[0].uri.fsPath};return new Promise(((t,n)=>{c.SpecsExplorerOutput.appendLine(`Running ${s}`);const i=u.exec(s,o,(e=>{e&&n(e)}));i.stdout?.on("data",(s=>{c.SpecsExplorerOutput.appendLine(s);const o=new d.TestGroup(e,r.name),n=s.split("\n");for(const e of n)this.parseTestLine(e,r,o);""===r.name?t(o.children):t([o])}))}))}async discover(e=void 0){const t=await(0,a.getSpecsConfig)();if(!t?.suites.length)return void i.window.showErrorMessage("No suites specified in specs.json");if(e||(e=Array.from(t.suitesById.keys())),!e.length)return;const r=[];return e.forEach((e=>{const s=t?.suitesById.get(e);s?.discoveryCommand&&r.push(this.discoverSuite(s.idenfifier()))})),Promise.all(r).then((e=>{const t=new d.TestGroup;return e.forEach((e=>{e&&t.children.push(...e)})),t.children}))}parseTestLine(e,t,r){const s=t.idenfifier(),o=new RegExp(t.discoveryRegex).exec(e);if(o&&o.groups){const e=o.groups.filepath,n=parseInt(o.groups.linenumber),i=o.groups.description.trim();if(c.SpecsExplorerOutput.appendLine(`Discovered test: ${i} (${e}:${n})`),t.groupSeparator){const o=i.split(t.groupSeparator).map((e=>e.trim())),u=o.pop()?.trim();if(0===o.length){c.SpecsExplorerOutput.appendLine(`Adding test ${u} to root group (${s}) [${e}:${n}]`);const t=new d.Test(s,u,e,n);return void r.children.push(t)}let a=r;o.forEach((t=>{let r=a.children.find((e=>e.description===t));r||(c.SpecsExplorerOutput.appendLine(`Adding test group ${t} to group ${a.description} (${s}) [${e}:${n}]`),r=new d.TestGroup(s,t,a),a.children.push(r)),a=r})),c.SpecsExplorerOutput.appendLine(`Adding test ${u} to group ${a.description} (${s}) [${e}:${n}]`);const p=new d.Test(s,u,e,n,a);a.children.push(p)}else{c.SpecsExplorerOutput.appendLine(`Adding test ${i.trim()} to root group (${s}) [${e}:${n}]`);const t=new d.Test(s,i.trim(),e,n);r.children.push(t)}}}};t.buildTestsProject=async function(){await p.build()},t.runTest=async function(e,t,r){return await p.run(e,t,r)},t.debugTest=async function(e,t,r){p.debug(e,t,r)},t.discoverTests=async function(){return await p.build(),await p.discover()}},439:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.TestResult=t.Test=t.TestGroup=t.TestComponentType=void 0,function(e){e[e.Test=0]="Test",e[e.TestGroup=1]="TestGroup"}(r||(t.TestComponentType=r={}));class s{suiteId;type=r.Test;description;group;constructor(e,t,r=void 0){this.suiteId=e,this.description=t,this.group=r}fullDescription(){return this.group?`${this.group.fullDescription()} > ${this.description}`:this.description}}t.TestGroup=class extends s{type=r.TestGroup;children=[];constructor(e=void 0,t="",r=void 0){super(e,t,r)}isRootGroup(){return void 0===this.group}},t.Test=class extends s{filePath;lineNumber;constructor(e,t,r,s,o=void 0){super(e,t,o),this.filePath=r,this.lineNumber=s}},t.TestResult=class{testOutput;testPassed;constructor(e="",t=!1){this.testOutput=e,this.testPassed=t}}},496:e=>{e.exports=require("vscode")},81:e=>{e.exports=require("child_process")}},t={};function r(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,r),n.exports}var s={};(()=>{var e=s;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const t=r(23);e.activate=function(e){(0,t.RegisterSpecsTestExtension)(e)},e.deactivate=function(){}})(),module.exports=s})();