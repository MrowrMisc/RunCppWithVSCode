(()=>{"use strict";var e={380:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.SpecsExplorerOutput=void 0;const n=i(r(398));t.SpecsExplorerOutput=n.window.createOutputChannel("Specs Explorer")},418:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getSpecsConfig=t.SpecsSuiteConfig=t.SpecsConfigFile=void 0;const n=i(r(398));class u{suites=[];defaults=new a;suitesById=new Map;anySuitesSupportDebug(){for(const[e,t]of this.suitesById)if(t.debugger&&t.debugExecutable)return!0;return!1}}t.SpecsConfigFile=u;class a{isGroup=!1;name;parent=void 0;children=[];buildCommand=void 0;discoveryCommand="";groupSeparator=void 0;tagsSeparator=void 0;discoveryRegex=void 0;runCommand="";debugExecutable=void 0;debugger=void 0;variables={};constructor(e="",t=void 0){this.name=e,this.parent=t}idenfifier(){return this.parent?`${this.parent.idenfifier()}/${this.name}`:this.name}}function d(e,t,r=void 0){if(void 0===e.name)throw new Error("Suite name is required");const s=new a(e.name,r);if(e.group&&(s.isGroup=e.group),e.build&&(s.buildCommand=e.build),e.discover&&(s.discoveryCommand=e.discover),e.groupSeparator&&(s.groupSeparator=e.groupSeparator),e.tagsSeparator&&(s.tagsSeparator=e.tagsSeparator),e.pattern&&(s.discoveryRegex=e.pattern),e.run&&(s.runCommand=e.run),e.debug&&(s.debugExecutable=e.debug),e.debugger&&(s.debugger=e.debugger),e.suites)for(const r of e.suites)s.children.push(d(r,t));for(const t in e)s.variables[t]=e[t];return t.suitesById.set(s.idenfifier(),s),s}t.SpecsSuiteConfig=a;let c,p=0;t.getSpecsConfig=async function(){return c&&(new Date).getTime()-p<500||(c=await async function(){const e=await n.workspace.findFiles(".specs.json");if(e.length>0){const t=await n.workspace.fs.readFile(e[0]);return function(e){const t=new u;if(e.suites)for(const r of e.suites)t.suites.push(d(r,t));else(e.run||e.discover)&&(e.name||(e.name=""),t.suites.push(d(e,t)));return e.defaults&&(e.defaults.name||(e.defaults.name="defaults"),t.defaults=d(e.defaults,t),t.defaults.isGroup=!0),t.suitesById.forEach((e=>{if(!e.isGroup){e.buildCommand||(e.buildCommand=t.defaults.buildCommand),e.discoveryCommand||(e.discoveryCommand=t.defaults.discoveryCommand),e.groupSeparator||(e.groupSeparator=t.defaults.groupSeparator),e.tagsSeparator||(e.tagsSeparator=t.defaults.tagsSeparator),e.discoveryRegex||(e.discoveryRegex=t.defaults.discoveryRegex),e.runCommand||(e.runCommand=t.defaults.runCommand),e.debugExecutable||(e.debugExecutable=t.defaults.debugExecutable),e.debugger||(e.debugger=t.defaults.debugger);for(const r in t.defaults.variables)e.variables[r]||(e.variables[r]=t.defaults.variables[r])}})),t.suitesById.forEach((e=>{!function(e){const t=e.variables;Object.keys(t).forEach((r=>{const s=t[r],o="$"+r;e.buildCommand&&(e.buildCommand=e.buildCommand.replace(o,s)),e.discoveryCommand&&(e.discoveryCommand=e.discoveryCommand.replace(o,s)),e.groupSeparator&&(e.groupSeparator=e.groupSeparator.replace(o,s)),e.tagsSeparator&&(e.tagsSeparator=e.tagsSeparator.replace(o,s)),e.discoveryRegex&&(e.discoveryRegex=e.discoveryRegex.replace(o,s)),e.runCommand&&(e.runCommand=e.runCommand.replace(o,s)),e.debugExecutable&&(e.debugExecutable=e.debugExecutable.replace(o,s)),e.debugger&&(e.debugger=e.debugger.replace(o,s))}))}(e)})),t}(JSON.parse(t.toString()))}n.window.showErrorMessage("No specs config file found")}(),p=(new Date).getTime()),c}},5:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RegisterSpecsTestExtension=void 0;const n=i(r(398)),u=r(418),a=r(116),d=r(3),c=r(209),p=new class{_controller;constructor(){this._controller=n.tests.createTestController("specs-explorer","Specs Explorer"),this._controller.refreshHandler=this.refresh.bind(this),this._controller.resolveHandler=async e=>{e?n.window.showErrorMessage("Resolving individual tests is not supported"):await this.refresh()},this._controller.createRunProfile("Run",n.TestRunProfileKind.Run,this.run.bind(this),!0),(0,u.getSpecsConfig)().then((e=>{e?.anySuitesSupportDebug()&&this._controller.createRunProfile("Debug",n.TestRunProfileKind.Debug,this.debug.bind(this),!0)}))}registerController(e){e.subscriptions.push(this._controller)}registerTestComponent(e,t,r){if(t.type===c.TestComponentType.Test){const s=t;e.add(s.identifier());const o=n.Uri.joinPath(n.workspace.workspaceFolders[0].uri,s.filePath),i=this._controller.createTestItem(s.identifier(),s.description,n.Uri.file(o.fsPath));(0,a.associateTestItemAndTest)(i,s),i.range=new n.Range(new n.Position(s.lineNumber-1,0),new n.Position(s.lineNumber-1,0)),r?r.children.add(i):this._controller.items.add(i)}else if(t.type===c.TestComponentType.TestGroup){const s=t;if(""===s.description)s.children.forEach((t=>{this.registerTestComponent(e,t,r)}));else{e.add(s.identifier());const t=this._controller.createTestItem(s.identifier(),s.description);r?r.children.add(t):this._controller.items.add(t),s.children.forEach((r=>{this.registerTestComponent(e,r,t)}))}}}async refresh(){const e=new Set;this._controller.items.forEach((t=>{e.add(t.id)}));const t=await(0,d.discoverTests)();if(!t)return n.window.showErrorMessage("Failed to discover tests"),void this._controller.items.forEach((e=>{this._controller.items.delete(e.id)}));const r=new Set;t.forEach((e=>{this.registerTestComponent(r,e)})),e.forEach((e=>{r.has(e)||this._controller.items.delete(e)}))}addTestsToRun(e,t){t.push(e),e.children.forEach((e=>{this.addTestsToRun(e,t)}))}async run(e,t){await(0,d.buildTestsProject)();const r=this._controller.createTestRun(e),s=[];for(e.include?e.include.forEach((e=>{this.addTestsToRun(e,s)})):this._controller.items.forEach((e=>{this.addTestsToRun(e,s)}));s.length>0&&!t.isCancellationRequested;){const t=s.pop();if(e.exclude?.includes(t))continue;const o=(0,a.testItemToTest)(t);if(!o)continue;if(o.type===c.TestComponentType.TestGroup)continue;const i=o,u=Date.now();r.started(t);const p=await(0,d.runTest)(i.suiteId,i.filePath,i.lineNumber);if(!p)continue;const l=Date.now()-u;p.testPassed?r.passed(t,l):r.failed(t,new n.TestMessage(p.testOutput),l)}r.end()}async debug(e,t){if(void 0===e.include)return void n.window.showErrorMessage("Debug all tests is not supported");if(e.include.length>1)return void n.window.showErrorMessage("Debugging multiple tests is not supported");const r=e.include[0],s=(0,a.testItemToTest)(r);if(s.type===c.TestComponentType.TestGroup)return;const o=s;await(0,d.buildTestsProject)(),await(0,d.debugTest)(o.suiteId,o.filePath,o.lineNumber)}};t.RegisterSpecsTestExtension=function(e){p.registerController(e)}},116:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.associateTestItemAndTest=t.testToTestItem=t.testItemToTest=void 0;const r=new WeakMap,s=new WeakMap;t.testItemToTest=function(e){return r.get(e)},t.testToTestItem=function(e){return s.get(e)},t.associateTestItemAndTest=function(e,t){r.set(e,t),s.set(t,e)}},3:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.discoverTests=t.debugTest=t.runTest=t.buildTestsProject=void 0;const n=i(r(398)),u=i(r(317)),a=r(418),d=r(209),c=r(380),p=new class{async buildSuite(e){if(!e.isGroup&&e.buildCommand){const t=e.buildCommand,r={cwd:n.workspace.workspaceFolders?.[0].uri.fsPath};return new Promise((e=>{c.SpecsExplorerOutput.appendLine(`Running ${t}`);const s=u.exec(t,r);s.stdout?.on("data",(e=>{c.SpecsExplorerOutput.appendLine(e)})),s.stderr?.on("data",(e=>{c.SpecsExplorerOutput.appendLine(e)})),s.on("close",(r=>{c.SpecsExplorerOutput.appendLine(`Command ${t} exited with code ${r}`),e()}))}))}}async build(e=void 0){const t=await(0,a.getSpecsConfig)();if(!t?.suites.length)return void n.window.showErrorMessage("No suites specified in specs.json");if(e||(e=Array.from(t.suitesById.keys())),!e.length)return;const r=[];return e.forEach((e=>{const s=t?.suitesById.get(e);s?.isGroup||s?.buildCommand&&r.push(this.buildSuite(s))})),Promise.all(r).then((()=>{}))}async run(e,t,r){const s=await(0,a.getSpecsConfig)(),o=s?.suitesById.get(e);if(o?.isGroup)return;if(!o)return void n.window.showErrorMessage(`Suite '${e}' not found in specs.json`);if(!o?.runCommand)return void n.window.showErrorMessage("No run command specified in specs.json");let i=new d.TestResult;const p=o.runCommand.replace("{file}",t).replace("{line}",r.toString());return new Promise((e=>{const t={cwd:n.workspace.workspaceFolders?.[0].uri.fsPath};c.SpecsExplorerOutput.appendLine(`Running ${p}`);const r=u.exec(p,t,(e=>{e&&(i.testPassed=!1)}));r.stdout?.on("data",(e=>{c.SpecsExplorerOutput.appendLine(e),i.testOutput+=e})),r.stderr?.on("data",(e=>{c.SpecsExplorerOutput.appendLine(e),i.testOutput+=e})),r.on("close",(t=>{c.SpecsExplorerOutput.appendLine(`Command ${p} exited with code ${t}`),i.testPassed=0===t,e(i)}))}))}async debug(e,t,r){const s=await(0,a.getSpecsConfig)(),o=s?.suitesById.get(e);o?.debugExecutable?o?.debugger?n.debug.startDebugging(n.workspace.workspaceFolders?.[0],{name:"Debug Test",type:o.debugger,request:"launch",program:o.debugExecutable,args:[t,r.toString()],cwd:"${workspaceFolder}",environment:[]}):n.window.showErrorMessage("No debugger specified (e.g. cppvsdbg) in specs.json"):n.window.showErrorMessage("No debug command specified in specs.json")}async discoverSuite(e){const t=await(0,a.getSpecsConfig)(),r=t?.suitesById.get(e);if(!r)return void n.window.showErrorMessage(`Suite '${e}' not found in specs.json`);if(r?.isGroup)return;if(!r?.discoveryCommand)return void n.window.showErrorMessage("No discovery command (discover:) specified in specs.json");if(!r?.discoveryRegex)return void n.window.showErrorMessage("No discovery regex (pattern:) specified in specs.json");const s=r.discoveryCommand,o={cwd:n.workspace.workspaceFolders?.[0].uri.fsPath};return new Promise(((t,i)=>{c.SpecsExplorerOutput.appendLine(`Running ${s}`);const n=u.exec(s,o,(e=>{e&&i(e)}));n.stdout?.on("data",(s=>{c.SpecsExplorerOutput.appendLine(s);const o=new d.TestGroup(e,r.name),i=s.split("\n");for(const e of i)this.parseTestLine(e,r,o);""===r.name?t(o.children):t([o])}))}))}async discover(e=void 0){const t=await(0,a.getSpecsConfig)();if(!t?.suites.length)return void n.window.showErrorMessage("No suites specified in specs.json");if(e||(e=Array.from(t.suitesById.keys())),!e.length)return;const r=[];return e.forEach((e=>{const s=t?.suitesById.get(e);s?.discoveryCommand&&r.push(this.discoverSuite(s.idenfifier()))})),Promise.all(r).then((e=>{const t=[];return e.forEach((e=>{e&&t.push(...e)})),t}))}parseTestLine(e,t,r){const s=t.idenfifier(),o=new RegExp(t.discoveryRegex).exec(e),i=t.tagsSeparator?t.tagsSeparator:",";if(o&&o.groups){const e=o.groups.filepath,n=o.groups.linenumber?parseInt(o.groups.linenumber):0,u=o.groups.tags?o.groups.tags.split(i):[],a=o.groups.description.trim();if(c.SpecsExplorerOutput.appendLine(`Discovered test: ${a} (${e}:${n})`),t.groupSeparator){const o=a.split(t.groupSeparator).map((e=>e.trim())),i=o.pop()?.trim();if(0===o.length){c.SpecsExplorerOutput.appendLine(`Adding test ${i} to root group (${s}) [${e}:${n}]`);const t=new d.Test(s,i,e,n,u);return void r.children.push(t)}let p=r;o.forEach((t=>{let r=p.children.find((e=>e.description===t));r||(c.SpecsExplorerOutput.appendLine(`Adding test group ${t} to group ${p.description} (${s}) [${e}:${n}]`),r=new d.TestGroup(s,t,p),p.children.push(r)),p=r})),c.SpecsExplorerOutput.appendLine(`Adding test ${i} to group ${p.description} (${s}) [${e}:${n}]`);const l=new d.Test(s,i,e,n,u,p);p.children.push(l)}else{c.SpecsExplorerOutput.appendLine(`Adding test ${a.trim()} to root group (${s}) [${e}:${n}]`);const t=new d.Test(s,a.trim(),e,n,u);r.children.push(t)}}}};t.buildTestsProject=async function(){await p.build()},t.runTest=async function(e,t,r){return await p.run(e,t,r)},t.debugTest=async function(e,t,r){p.debug(e,t,r)},t.discoverTests=async function(){return await p.build(),await p.discover()}},209:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.TestResult=t.Test=t.TestGroup=t.TestComponentType=void 0,function(e){e[e.Test=0]="Test",e[e.TestGroup=1]="TestGroup"}(r||(t.TestComponentType=r={}));class s{suiteId;type=r.Test;description;group;constructor(e,t,r=void 0){this.suiteId=e,this.description=t,this.group=r}fullDescription(){return this.group?`${this.group.fullDescription()} > ${this.description}`:this.description}}t.TestGroup=class extends s{type=r.TestGroup;children=[];constructor(e,t="",r=void 0){super(e,t,r)}isRootGroup(){return void 0===this.group}identifier(){return`[GROUP]--${this.suiteId}--${this.description}`}},t.Test=class extends s{filePath;lineNumber;tags=[];constructor(e,t,r,s,o=[],i=void 0){super(e,t,i),this.filePath=r,this.lineNumber=s}identifier(){return`${this.suiteId}--${this.filePath}--${this.lineNumber}--${this.description}`}},t.TestResult=class{testOutput;testPassed;constructor(e="",t=!1){this.testOutput=e,this.testPassed=t}}},398:e=>{e.exports=require("vscode")},317:e=>{e.exports=require("child_process")}},t={};function r(s){var o=t[s];if(void 0!==o)return o.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,r),i.exports}var s={};(()=>{var e=s;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const t=r(5);e.activate=function(e){(0,t.RegisterSpecsTestExtension)(e)},e.deactivate=function(){}})(),module.exports=s})();